#!/bin/sh

# Functions necessary to run this config
source "$ZDOTDIR/zsh_functions"

### Source all the files

# All of below depend on `zsh_functions`
zsh_add_file "zsh_exports"

################################################
           ### PEEPOS, first of all...
     [[ -o login ]] && random-pepe 2>/dev/null
################################################

# Continue normally with mundane stuff...
zsh_add_file "zsh_options"
zsh_add_file "zsh_aliases"
zsh_add_file "zsh_prompt"
zsh_add_file "zsh_vim_mode"
zsh_add_file "zsh_keybindings"
zsh_add_file "zsh_plugins"

### Load ZSH modules

# Enable profiling
zmodload zsh/zprof

### Start X on login

maybe_startx () {

  # Continue to the terminal if in the pseudo terminal, not TTY
  tty | grep -q '^/dev/pts' && return

  echo "Starting X server...";

  # Trow to shell if not on first TTY
  if [ ! "$(tty)" = '/dev/tty1' ]; then
    echo "ERROR: You are not in the first TTY. X server won't start."
    echo "Leaving you in the shell."
    return;
  fi

  # Throw to shell if `DISPLAY` is already set
  if ! [ -z $DISPLAY ]; then
    echo "ERROR: \`DISPLAY\` is already set. X server already running on this TTY and you seeng this message. Something wrong."
    echo "Leaving you in the shell."
    return
  fi

  # Throw to shell if `startx` is missing
  if [ ! -x /bin/startx ]; then
    echo "ERROR: Seems like the X server is not installed or not properly installed: \`startx\` is not in your \`PATH\`. X server won't start."
    echo "Leaving you in the shell."
    return
  fi

  exec startx >> $HOME/.local/share/xinitrc/xinitrc.log 2>> $HOME/.local/share/xinitrc/xinitrc.error.log
}

# Only start if `DISPLAY == "" && startx`
maybe_startx


# FZF
#source /usr/share/fzf/key-bindings.zsh
#source /usr/share/fzf/completion.zsh
#export FZF_DEFAULT_COMMAND='rg --hidden -l ""'

